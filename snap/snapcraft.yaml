name: asimov
base: core22
version: 'auto'
summary: ASIMOV CLI Snap
description: "Bundles prebuilt ASIMOV CLI and subcommands into a snap."

grade: devel
confinement: classic

parts:
  asimov-cli:
    plugin: dump
    source: .
    override-pull: |
      snapcraftctl pull

      for name in asimov-cli asimov-module-cli asimov-dataset-cli; do
        FILE="${BINARY_NAME}.gz"
        wget -O "${name}.gz" "https://github.com/asimov-platform/${name}/releases/latest/download/${FILE}"
        gunzip "${name}.gz"
        chmod +x "${name}"
      done

    override-build: |
      mkdir -p "$SNAPCRAFT_PART_INSTALL/bin"
      mv asimov "$SNAPCRAFT_PART_INSTALL/bin/asimov"
      mv module-cli "$SNAPCRAFT_PART_INSTALL/bin/asimov-module"
      mv dataset-cli "$SNAPCRAFT_PART_INSTALL/bin/asimov-dataset"
      snapcraftctl build

apps:
  asimov:
    command: bin/asimov
